buildscript {
	ext {
		springBootVersion = '2.1.5.RELEASE'
		springVersion = '5.1.0.RELEASE'
	}
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

apply plugin: "org.springframework.boot"
apply plugin: "groovy"
apply plugin: "maven"
apply plugin: 'io.spring.dependency-management'

group = 'com.wkelms.scanner'
version = '1.0.1'
sourceCompatibility = '1.8'

repositories {
	mavenLocal()
	maven{
		url "https://nexus.wkelms.com/repository/public"
	}
	mavenCentral()
}
bootJar {
	mainClassName = 'com.wkelms.clamav.VirusScannerApplication'
	exclude ("*.jks")
	exclude ("*.yml*")
	exclude ("*.xml")
	exclude ("*.exe")
}

task dist(type: Copy, dependsOn: bootJar) {
	def distDir = file ('build/dist/')
	distDir.mkdir()
	from 'build/libs'
	into 'build/dist'
	include "${project.name}-${project.version}.jar"
	rename("${project.name}-${project.version}.jar","VirusScanner-${project.version}.jar")
}

uploadArchives {
	repositories {
		mavenDeployer {
			repository(url: "https://nexus.wkelms.com/repository/cp-releases/") {
				authentication(userName: "deployment", password: "datacert")
			}
			snapshotRepository(url: "https://nexus.wkelms.com/repository/cp-snapshots/") {
				authentication(userName: "deployment", password: "datacert")
			}
			println "Uploading VirusScanner-$version to Nexus Repo"
			pom.version = "$version"
			pom.artifactId = "VirusScanner"
			pom.groupId = "com.wkelms.clamav"
		}
	}
}

dependencies {
	compile group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.4.15'
	compile group: 'org.springframework.boot', name: 'spring-boot-starter-actuator', version: "${springBootVersion}"
	compile group: 'org.springframework.boot', name: 'spring-boot-starter-web', version: "${springBootVersion}"
	testCompile group: 'org.springframework.boot', name: 'spring-boot-starter-test', version: "${springBootVersion}"
}

